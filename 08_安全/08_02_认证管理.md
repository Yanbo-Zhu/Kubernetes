
# 1 Kubernetes 的客户端身份认证方式

 Kubernetes 集群安全的关键点在于如何识别并认证客户端身份，它提供了 3 种客户端身份认证方式：

- HTTP Base 认证：
    - 通过 `用户名+密码` 的方式进行认证。
    - 这种方式是把 `用户名:密码` 用 BASE64 算法进行编码后的字符串放在 HTTP 请求中的 Header 的 Authorization 域里面发送给服务端。服务端收到后进行解码，获取用户名和密码，然后进行用户身份认证的过程。
- HTTP Token 认证：
    - 通过一个 Token 来识别合法用户。
    - 这种认证方式是用一个很长的难以被模仿的字符串--Token 来表明客户端身份的一种方式。每个 Token 对应一个用户名，当客户端发起 API 调用请求的时候，需要在 HTTP 的 Header 中放入 Token，API Server 接受到 Token 后会和服务器中保存的 Token 进行比对，然后进行用户身份认证的过程。
- HTTPS 证书认证：
    - 基于 CA 根证书签名的双向数字证书认证方式。
    - 这种认证方式是安全性最高的一种方式，但是同时也是操作起来最麻烦的一种方式。



# 2 HTTPS 证书认证

![img](https://gitee.com/yooome/golang/raw/main/22-k8s%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B-%E8%B0%83%E6%95%B4%E7%89%88/Kubenetes.assets/image-20200518211037434.png)


**HTTPS认证大体分为3个过程：**

1. 证书申请和下发
    
      HTTPS通信双方的服务器向CA机构申请证书，CA机构下发根证书、服务端证书及私钥给申请者
    
2. 客户端和服务端的双向认证
    
      1> 客户端向服务器端发起请求，服务端下发自己的证书给客户端，
         客户端接收到证书后，通过私钥解密证书，在证书中获得服务端的公钥，
         客户端利用服务器端的公钥认证证书中的信息，如果一致，则认可这个服务器
      2> 客户端发送自己的证书给服务器端，服务端接收到证书后，通过私钥解密证书，
         在证书中获得客户端的公钥，并用该公钥认证证书信息，确认客户端是否合法
    
3. 服务器端和客户端进行通信
    
      服务器端和客户端协商好加密方案后，客户端会产生一个随机的秘钥并加密，然后发送到服务器端。
      服务器端接收这个秘钥后，双方接下来通信的所有内容都通过该随机秘钥加密
    

> 注意: Kubernetes允许同时配置多种认证方式，只要其中任意一个方式认证通过即可
  

